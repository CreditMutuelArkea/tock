<!--
  ~ Copyright (C) 2017/2021 e-voyageurs technologies
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<nb-card class="mt-3">
  <nb-card-header class="d-flex justify-content-between align-items-center flex-wrap gap-1">
    <span>
      Application
      <span *ngIf="application?.name">"{{ application.name }}"</span>
    </span>
    <div>
      <button
        *ngIf="!newApplication"
        nbButton
        status="danger"
        ghost
        shape="round"
        nbTooltip="Delete"
        (click)="deleteApplication()"
      >
        <nb-icon icon="trash-2-outline"></nb-icon>
      </button>
      <button
        nbButton
        status="primary"
        ghost
        shape="round"
        (click)="saveApplication()"
        [nbTooltip]="newApplication ? 'Create' : 'Update'"
      >
        <nb-icon icon="save-outline"></nb-icon>
      </button>
      <button
        class="ml-4"
        nbButton
        ghost
        shape="round"
        nbTooltip="Cancel"
        (click)="cancel()"
      >
        <nb-icon icon="close-outline"></nb-icon>
      </button>
    </div>
  </nb-card-header>
  <nb-card-body *ngIf="application">
    <nb-card class="section-card">
      <nb-card-body>
        <div class="form-field d-flex flex-column mb-3">
          <div class="d-flex align-items-center justify-content-between">
            <label
              class="required font-weight-bold text-mitigated"
              for="appLabel"
            >
              <abbr title="Required">*</abbr>
              Label
            </label>
            <nb-icon
              class="control-info"
              icon="info-outline"
              size="small"
              status="info"
              nbTooltip="Displayed label"
            ></nb-icon>
          </div>
          <input
            #appLabel
            nbInput
            tockAutofocusElement
            name="appLabel"
            id="appLabel"
            placeholder="Enter an application label"
            fullWidth
            required
            autocomplete="off"
            [(ngModel)]="application.label"
            (keyup)="format()"
            (keyup.enter)="saveApplication()"
          />
        </div>
        <div class="form-field d-flex flex-column mb-3">
          <div class="d-flex align-items-center justify-content-between">
            <label
              class="required font-weight-bold text-mitigated"
              for="appName"
            >
              <abbr title="Required">*</abbr>
              Name
            </label>
            <nb-icon
              class="control-info"
              icon="info-outline"
              size="small"
              status="info"
              nbTooltip="Technical name (without special chars)"
            ></nb-icon>
          </div>
          <input
            #appName
            nbInput
            name="appName"
            id="appName"
            placeholder="Enter an application name"
            fullWidth
            required
            autocomplete="off"
            [disabled]="!newApplication"
            [(ngModel)]="application.name"
            (keyup.enter)="saveApplication()"
          />
        </div>
        <div class="form-field d-flex flex-column mb-3">
          <div class="d-flex align-items-center justify-content-between">
            <label
              class="font-weight-bold text-mitigated"
              for="unknownIntentThreshold"
              >Unknown intent threshold</label
            >
            <nb-icon
              class="control-info"
              icon="info-outline"
              size="small"
              status="info"
              nbTooltip="Number between 0 and 1 - if the probability of the intent is below the threshold, unknown intent is returned"
            ></nb-icon>
          </div>
          <input
            nbInput
            name="unknownIntentThreshold"
            id="unknownIntentThreshold"
            type="number"
            placeholder="Unknown intent threshold"
            fullWidth
            min="0"
            max="1"
            step="0.01"
            [(ngModel)]="application.unknownIntentThreshold"
          />
        </div>
        <div class="d-flex flex-wrap gap-1">
          <nb-checkbox
            [(ngModel)]="application.normalizeText"
            nbTooltip="If selected, this option uses normalized text models - for intent only models"
          >
            Normalized text models
          </nb-checkbox>
          <nb-checkbox
            *ngIf="!application.normalizeText"
            [(ngModel)]="application.mergeEngineTypes"
            nbTooltip="If selected, this option uses built-in entity models (like dates) in conjunction with standard NER"
          >
            Use entity models
          </nb-checkbox>
          <nb-checkbox
            *ngIf="!application.normalizeText && !application.mergeEngineTypes"
            [(ngModel)]="application.useEntityModels"
            nbTooltip="If selected, built-in entity models results are provided only for info and potential entity disambiguation"
          >
            Entity disambiguation only
          </nb-checkbox>
          <nb-checkbox
            *ngIf="!application.normalizeText"
            [(ngModel)]="application.supportSubEntities"
            nbTooltip="If selected, you can use subentities in your nlp models"
            >Allow subentities
          </nb-checkbox>
        </div>
      </nb-card-body>
    </nb-card>
    <nb-card
      *ngIf="state.locales"
      class="section-card"
    >
      <nb-card-header>Locales</nb-card-header>
      <nb-card-body class="d-flex flex-column gap-1">
        <nb-select
          class="form-field"
          placeholder="Add new locale"
          [(ngModel)]="newLocale"
          (selectedChange)="addLocale()"
        >
          <nb-option
            *ngFor="let locale of state.locales"
            [value]="locale.first"
          >
            {{ locale.second }}
          </nb-option>
        </nb-select>

        <nb-tag-list *ngIf="application.supportedLocales.length !== 0">
          <nb-tag
            *ngFor="let locale of application.supportedLocales"
            nbTooltip="Delete locale"
            removable
            [text]="state.localeName(locale)"
            (click)="removeLocale(locale)"
          ></nb-tag>
        </nb-tag-list>
      </nb-card-body>
    </nb-card>
    <nb-card class="section-card">
      <nb-card-header>NLU engine</nb-card-header>
      <nb-card-body>
        <nb-radio-group
          id="engines"
          name="engines-group"
          [(ngModel)]="nlpEngineType"
          (valueChange)="changeNlpEngine($event)"
        >
          <nb-radio
            class="engine-type"
            *ngFor="let engine of state.supportedNlpEngines"
            [value]="engine.name"
          >
            {{ engine.name }}
          </nb-radio>
        </nb-radio-group>
      </nb-card-body>
    </nb-card>

    <tock-application-advanced-options
      *ngIf="!newApplication"
      [application]="application"
      [nlpEngineTypeChange]="nlpEngineTypeChange"
    >
    </tock-application-advanced-options>
  </nb-card-body>
</nb-card>
