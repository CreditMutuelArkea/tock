<!--
  ~ Copyright (C) 2017/2021 e-voyageurs technologies
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<div class="d-flex gap-1">
  <img
    *ngIf="!isBot"
    src="assets/images/scenario-client.svg"
    class="avatar align-self-start"
    nbTooltip="{{ action.date | date: 'y/MM/dd HH:mm:ss' }}"
  />
  <img
    *ngIf="isBot"
    src="assets/images/scenario-bot.svg"
    class="avatar align-self-start"
    nbTooltip="{{ action.date | date: 'y/MM/dd HH:mm:ss' }}"
  />

  <div
    *ngIf="message"
    class="message d-flex mb-1"
    [ngClass]="{ bot: isBot, 'text-muted': !isBot }"
  >
    <div class="flex-grow-1 align-self-center">
      <div *ngIf="message.isSentence()">
        <tock-rag-monitoring-sentence [sentence]="message"></tock-rag-monitoring-sentence>
      </div>
      <div *ngIf="message.isAttachment()">
        <tock-rag-monitoring-attachement [attachment]="message"></tock-rag-monitoring-attachement>
      </div>
      <div *ngIf="message.isChoice()">
        <tock-rag-monitoring-choice [choice]="message"></tock-rag-monitoring-choice>
      </div>
      <div *ngIf="message.isLocation()">
        <tock-rag-monitoring-location [location]="message"></tock-rag-monitoring-location>
      </div>
    </div>

    <div
      *ngIf="isBot"
      class="d-flex align-items-center"
    >
      <button
        nbButton
        ghost
        shape="round"
        status="success"
        size="large"
        nbTooltip="Validate this answer"
        (click)="validateAnswer()"
        [disabled]="message._validated || message._signaled"
      >
        <nb-icon icon="checkmark-circle-2"></nb-icon>
      </button>
      <button
        nbButton
        ghost
        shape="round"
        status="danger"
        size="large"
        nbTooltip="Report an inappropriate answer"
        (click)="signalAnswer($event, message)"
        [disabled]="message._validated || message._signaled"
      >
        <nb-icon icon="close-circle"></nb-icon>
      </button>
    </div>
  </div>
</div>

<ng-template #signalementMenu>
  <section
    class="signalement-menu pt-1"
    (click)="$event.stopPropagation()"
  >
    <form
      [formGroup]="form"
      (submit)="(submitSignalAnswer)"
    >
      <nb-radio-group
        formControlName="reason"
        name="reason"
      >
        <nb-radio value="inappropriate"> Inappropriate or incorrect response </nb-radio>
        <nb-radio value="incomplete"> Incomplete or confused response </nb-radio>
        <nb-radio value="incorrect"> Response based on incorrect or out-of-date information </nb-radio>
      </nb-radio-group>

      <textarea
        nbInput
        fullWidth
        fieldSize="tiny"
        placeholder="Comment (optional)"
        class="mt-2"
        formControlName="comment"
      ></textarea>

      <button
        type="button"
        status="primary"
        nbButton
        size="small"
        class="mt-2 mr-2"
        [disabled]="!canSubmit"
        (click)="submitSignalAnswer()"
      >
        Submit
      </button>

      <button
        type="button"
        status="basic"
        nbButton
        size="small"
        class="mt-2"
        (click)="hideSignalementMenu()"
      >
        Cancel
      </button>
    </form>
  </section>
</ng-template>
