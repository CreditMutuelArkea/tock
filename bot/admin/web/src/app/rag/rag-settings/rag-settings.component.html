<form [formGroup]="form">
  <nb-card class="mt-3">
    <nb-card-header class="d-flex flex-wrap align-items-center justify-content-between">
      Retrieval Augmented Generation settings

      <nb-toggle
        class="m-2"
        nbTooltip="Activate/deactivate Rag"
      >
        Activate/deactivate Rag
      </nb-toggle>
    </nb-card-header>

    <nb-card-body>
      <tock-form-control
        label="LLM Engine"
        name="engine"
        [controls]="engine"
        [required]="true"
      >
        <nb-radio-group
          formControlName="engine"
          class="d-flex"
        >
          <nb-radio
            *ngFor="let engine of LlmEngines"
            [value]="engine.value"
          >
            {{ engine.label }}
          </nb-radio>
        </nb-radio-group>
      </tock-form-control>

      <div
        *ngIf="engine.value"
        class="mt-2"
      >
        <div class="font-weight-bold mb-3">{{ currentEngineLabel }} parameters</div>

        <div class="engine-params">
          <div *ngFor="let param of currentEngineParams">
            <tock-form-control
              [label]="param.label"
              [name]="param.key"
              [controls]="param.key"
              [required]="true"
              [boldLabel]="false"
            >
              <ng-container *ngIf="param.type === 'string'">
                <input
                  nbInput
                  fullWidth
                  [formControlName]="param.key"
                />
              </ng-container>

              <ng-container *ngIf="param.type === 'list'">
                <nb-select
                  fullWidth
                  [formControlName]="param.key"
                >
                  <nb-option
                    *ngFor="let source of param.source"
                    [value]="source"
                  >
                    {{ source }}
                  </nb-option>
                </nb-select>
              </ng-container>
            </tock-form-control>
          </div>
        </div>
      </div>

      <tock-form-control
        label="Temperature"
        name="temperature"
        [controls]="temperature"
        [required]="true"
      >
        <div class="d-flex align-items-center justify-content-between range-slider">
          <input
            type="range"
            min="0"
            max="1"
            step="0.05"
            formControlName="temperature"
          />
          <div class="range-slider-value">{{ temperature.value }}</div>
        </div>
      </tock-form-control>
    </nb-card-body>
  </nb-card>
</form>
