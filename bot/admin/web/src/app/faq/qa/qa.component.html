<!--
  ~ Copyright (C) 2017/2022 e-voyageurs technologies
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<h5 class="h5 mb-4">Questions & Answers {{applicationName}}</h5>
<tock-qa-header [viewMode]="viewMode"
                [ngClass]="{ 'tock--docked': isDocked() }"
                [filter]="filter"
                (onSearch)="search($event)"
                (onNew)="openNewSidepanel()"
                (onImport)="openImportSidepanel()">
</tock-qa-header>
<div class="tock-qa-viewport d-flex justify-content-between w-100"
     [ngClass]="{
     'tock--docked-panel': isDocked(),
     'tock--full_width': viewMode === 'FULL_WIDTH',
     'tock--full_width--small': viewMode === 'RESPONSIVE_FULL_WIDTH'
     }"
>
  <tock-qa-grid (onEdit)="edit($event)"  [viewMode]="viewMode" [filter]="filter"></tock-qa-grid>

  <tock-inview-sidepanel [isContentHeader]="false" [ngClass]="'tock-qa-sidebar'" *ngIf="isPanelDocked('import')" (onClose)="undock()">
    <div tock-header>
      <h5>Import FAQ</h5>
    </div>
    <tock-qa-sidebar-import-content tock-content></tock-qa-sidebar-import-content>

    <ng-container tock-footer>
      <button class="float-left mx-2" nbButton outline status="primary" size="small" (click)="undock()" >
        Cancel
      </button>
      <button class="float-right mx-2" nbButton status="primary" size="small">
        Start
      </button>
    </ng-container>
  </tock-inview-sidepanel>

  <tock-inview-sidepanel [isContentHeader]="true" [ngClass]="'tock-qa-sidebar'" *ngIf="isPanelDocked('edit')" (onClose)="undock()">
    <div tock-header>
      <h5>{{editorPanelName || 'QA Editor'}}</h5>
    </div>

    <ng-container tock-contentheader>
      <span (click)="activateEditorTab('Info')" class="tock-tab"
            [ngClass]="{'tock--active': activeQaTab === 'Info'}" >
        Info
      </span>
      <span (click)="activateEditorTab('Question')" class="tock-tab"
            [ngClass]="{'tock--active': activeQaTab === 'Question'}">
        Question
      </span>
      <span (click)="activateEditorTab('Answer')" class="tock-tab"
            [ngClass]="{'tock--active': activeQaTab === 'Answer'}">
        Answer
      </span>

      <div *ngIf="editorFormWarnings.length > 0"
           [nbPopover]="editorwarnings"
           nbPopoverTrigger="hint"
           nbPopoverPlacement="bottom"
           class="tock-form-problems float-right">
        <nb-icon icon="alert-triangle-outline"></nb-icon>

        {{editorFormWarnings.length}}
      </div>
    </ng-container>

    <tock-qa-sidebar-editor-content tock-content
      (validityChanged)="onEditorValidityChanged($event)"
      [tabName]="activeQaTab"
      [fq]="currentItem">
    </tock-qa-sidebar-editor-content>

    <ng-container tock-footer>
      <button class="float-left mx-2" nbButton outline status="primary" size="small" (click)="undock()" >
        Cancel
      </button>
      <button [disabled]="!editorFormValid" class="float-right mx-2"
              (click)="save()"
              nbButton status="primary" size="small">
        Save
      </button>
    </ng-container>

  </tock-inview-sidepanel>

</div>

<ng-template #editorwarnings>
  <nb-card [ngClass]="'tock-editor-warns'" status="danger" [style]="{'margin-bottom': 0}">

    <nb-list>
      <nb-list-item *ngFor="let message of editorFormWarnings">
        {{ message }}
      </nb-list-item>
    </nb-list>

  </nb-card>
</ng-template>
