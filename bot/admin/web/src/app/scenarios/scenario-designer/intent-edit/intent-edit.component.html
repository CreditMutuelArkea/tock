<nb-card id="modal-wrapper">
  <nb-card-header class="d-flex justify-content-between align-items-start">
    <h4>Intent definition</h4>

    <button
      nbButton
      ghost
      shape="round"
      nbTooltip="Cancel"
      (click)="cancel()"
    >
      <nb-icon icon="close-outline"></nb-icon>
    </button>
  </nb-card-header>

  <nb-card-body>
    <div>
      <label class="font-weight-bold">Status :</label>
      <span *ngIf="item.intentDefinition.intentId">
        Already exists. Will be reassigned upon publication.
      </span>
      <span *ngIf="!item.intentDefinition.intentId">
        Does not exist. Will be created upon publishing.
      </span>
    </div>
    <div *ngIf="item.intentDefinition.intentId">
      <label class="font-weight-bold">Id :</label>
      <span>
        {{ item.intentDefinition.intentId }}
      </span>
    </div>
    <div>
      <label class="font-weight-bold">Name :</label>
      <span>
        {{ item.intentDefinition.name }}
      </span>
    </div>
    <div *ngIf="item.intentDefinition.label">
      <label class="font-weight-bold">Label :</label>
      <span>
        {{ item.intentDefinition.label }}
      </span>
    </div>

    <div *ngIf="item.intentDefinition.description">
      <label class="font-weight-bold">Description :</label>
      <span>
        {{ item.intentDefinition.description }}
      </span>
    </div>
    <div *ngIf="item.intentDefinition.category">
      <label class="font-weight-bold">Category :</label>
      <span>
        {{ item.intentDefinition.category }}
      </span>
    </div>

    <hr class="my-2" />

    <strong> Questions matching this Intent :</strong>
    <div class="questions">
      <ul>
        <li
          *ngFor="let sentence of sentences.value"
          class="d-flex justify-content-between align-items-start"
        >
          <div class="text-muted">
            <span
              *ngFor="let token of sentence._tokens"
              [ngClass]="{ token: token.entity, 'cursor-default': !token.entity }"
              [title]="'Entity : ' + token.entity?.role"
              [style.background]="token.color()"
              [style.color]="getContrastYIQ(token.color())"
              [nbContextMenu]="contextItems"
              nbContextMenuTag="contextsMenu"
              nbContextMenuTrigger="noop"
              (click)="displayContextsMenu($event, token)"
              >{{ token.text }}</span
            >
          </div>
          <div>
            <nb-icon
              icon="trash-2-outline"
              status="danger"
              (click)="removeSentence(sentence)"
              class="pointer"
              nbTooltip="Remove this formulation"
            ></nb-icon>
          </div>
        </li>
      </ul>

      <ul>
        <li
          *ngFor="let sentence of _sentences"
          class="d-flex justify-content-between align-items-start"
        >
          <div class="text-muted">
            <span
              *ngFor="let token of sentence._tokens"
              [ngClass]="{ token: token.entity, 'cursor-default': !token.entity }"
              [nbTooltip]="getTokenTooltip(token)"
              [style.background]="token.color()"
              [style.color]="getContrastYIQ(token.color())"
              ><span
                [nbContextMenu]="contextItems"
                nbContextMenuTag="contextsMenu"
                nbContextMenuTrigger="noop"
                (click)="displayContextsMenu($event, token)"
                >{{ token.text }}</span
              ><nb-icon
                icon="attach-outline"
                class="pointer valign-middle ml-1"
                *ngIf="getContextOfEntity(token)"
                (click)="dissociateContextFromEntity(token)"
              ></nb-icon
            ></span>
          </div>
        </li>
      </ul>
    </div>

    <div class="d-flex mt-2">
      <input
        #addSentenceInput
        nbInput
        fullWidth
        id="newQuestion"
        type="text"
        placeholder="Add a new question formulation and press enter"
        (keyup.enter)="addSentence()"
      />

      <button
        type="button"
        nbButton
        ghost
        size="small"
        class="ml-1"
        [disabled]="!addSentenceInput.value.length"
        (click)="addSentence()"
      >
        Add
      </button>
    </div>
  </nb-card-body>

  <nb-card-footer class="d-flex justify-content-between">
    <button
      nbButton
      size="small"
      status="basic"
      class="m-1"
      (click)="cancel()"
    >
      Cancel
    </button>

    <button
      nbButton
      size="small"
      status="danger"
      class="m-1"
      (click)="dissociateIntent()"
    >
      <nb-icon icon="slash-outline"></nb-icon>
      <span *ngIf="item.intentDefinition.intentId"> Dissociate intent </span>
      <span *ngIf="!item.intentDefinition.intentId"> Delete intent </span>
    </button>

    <button
      nbButton
      size="small"
      status="primary"
      class="m-1"
      (click)="save()"
    >
      <nb-icon icon="save-outline"></nb-icon>
      Save
    </button>
  </nb-card-footer>
</nb-card>
