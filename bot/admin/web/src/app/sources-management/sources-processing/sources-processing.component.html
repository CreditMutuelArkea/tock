<div
  class="fixed-section"
  [ngClass]="{ 'fixed-section-shadow': showScrollToTopButton$ | async }"
>
  <div class="d-flex justify-content-between flex-wrap align-items-center">
    <div>
      <h1 class="mb-0">Sources Management</h1>
      <h6 class="mb-0">Fragments selection</h6>
    </div>

    <div class="d-flex gap-1">
      <button
        nbButton
        status="basic"
        size="medium"
        routerLink="/sources-management/board"
      >
        Cancel
      </button>

      <button
        nbButton
        status="primary"
        size="medium"
        (click)="submit(confirmNextStepModal)"
      >
        Save
        <nb-icon icon="checkmark-outline"></nb-icon>
      </button>
    </div>
  </div>

  <section
    class="py-2 mb-2 d-flex justify-content-between gap-1"
    *ngIf="fragments"
  >
    <div>{{ selectedFragments?.length }} / {{ fragments.length }} fragments selected</div>

    <div class="d-flex gap-1">
      <nb-select
        placeholder="Select fragments"
        size="small"
        (selectedChange)="selectFragments($event)"
      >
        <nb-option value="all">Select all fragments</nb-option>
        <nb-option value="none">Unselect all fragments</nb-option>
        <nb-option value="revert">Reverse selection</nb-option>
        <nb-option value="limit">Select fragments by string length</nb-option>
      </nb-select>
    </div>
  </section>
</div>

<section
  infiniteScroll
  [infiniteScrollDistance]="2"
  [infiniteScrollThrottle]="50"
  (scrolled)="onScroll()"
>
  <nb-card
    class="mb-2"
    *ngFor="let fragment of scrolledFragments"
  >
    <nb-card-body>
      <!-- <div
        class="fragment-edit float-left mr-3 mb-2"
        *ngIf="!fragment._edit"
      >
        <button
          nbButton
          ghost
          size="tiny"
          nbTooltip="Edit text"
          (click)="edit(fragment)"
        >
          <nb-icon icon="edit-outline"></nb-icon>
          Edit
        </button>
      </div> -->

      <div
        class="fragment-selector float-right ml-3 mb-2"
        *ngIf="!fragment._edit"
      >
        <nb-checkbox
          [checked]="fragment.use"
          (checkedChange)="toggle(fragment)"
          >Select this fragment</nb-checkbox
        >
      </div>

      <span
        (click)="toggle(fragment)"
        class="pointer"
        *ngIf="!fragment._edit"
        [innerHTML]="fragment.answer"
      >
        <!-- {{ fragment.answer }} -->
      </span>

      <div
        class="flex-grow-1"
        *ngIf="fragment._edit"
      >
        <textarea
          nbInput
          fullWidth
          [(ngModel)]="editionValue"
          rows="5"
        ></textarea>

        <div class="d-flex gap-1 mt-2">
          <button
            type="button"
            nbButton
            nbTooltip="Validate changes"
            size="small"
            status="success"
            (click)="validateEdit(fragment)"
          >
            <nb-icon icon="checkmark-outline"></nb-icon>
            Validate
          </button>

          <button
            type="button"
            nbButton
            nbTooltip="Cancel changes"
            ghost
            size="small"
            (click)="cancelEdit(fragment)"
          >
            <nb-icon icon="close-outline"></nb-icon>
            Cancel
          </button>
        </div>
      </div>
    </nb-card-body>
  </nb-card>
</section>

<div
  class="top-scroller"
  *ngIf="showScrollToTopButton$ | async"
  (click)="onScrollToTop()"
  nbTooltip="Scroll to page top"
>
  <nb-icon icon="chevron-up-outline"></nb-icon>
</div>

<ng-template #confirmNextStepModal>
  <nb-card>
    <nb-card-header class="d-flex justify-content-between align-items-start gap-1">
      <span> Generate questions ? </span>
    </nb-card-header>

    <nb-card-body> Do you want to generate questions now ? </nb-card-body>

    <nb-card-footer>
      <div class="d-flex justify-content-between">
        <button
          type="button"
          nbButton
          outline
          status="primary"
          size="small"
          (click)="cancelNextStep()"
        >
          Later
        </button>
        <button
          type="button"
          nbButton
          status="primary"
          size="small"
          (click)="generateQuestions()"
        >
          Generate questions
        </button>
      </div>
    </nb-card-footer>
  </nb-card>
</ng-template>
