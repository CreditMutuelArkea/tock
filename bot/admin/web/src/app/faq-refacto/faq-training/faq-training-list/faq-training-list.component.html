<div class="grid-columns-header mb-1">
  <div>
    <nb-checkbox
      [checked]="selection?.selected?.length === sentences?.length"
      [indeterminate]="selection?.selected?.length && selection.selected.length < sentences?.length"
      (checkedChange)="handleToggleSelectAll($event)"
    ></nb-checkbox>
  </div>
  <div>
    <span
      class="pointer"
      (click)="toggleSort()"
    >
      Sort by creation date
      <nb-icon
        *ngIf="!sort"
        icon="chevron-down-outline"
        class="valign-middle"
      ></nb-icon>
      <nb-icon
        *ngIf="sort"
        icon="chevron-up-outline"
        class="valign-middle"
      ></nb-icon>
    </span>
  </div>

  <div>
    <nb-form-field>
      <nb-icon
        nbPrefix
        pack="material-icons"
        icon="bolt"
      ></nb-icon>
      <div class="nb-form-control-container nb-form-field-control-with-prefix">
        <nb-select
          placeholder="Apply to selection"
          size="small"
          [disabled]="!selection.selected.length"
        >
          <nb-option
            class="tock--success"
            tock-click-capture
            (click)="handleBatchAction(Action.VALIDATE)"
          >
            <nb-icon
              [ngClass]="['float-right', 'mr-2']"
              icon="checkmark-circle-2"
            ></nb-icon>
            Validate
          </nb-option>
          <nb-option
            class="tock--danger"
            tock-click-capture
            (click)="handleBatchAction(Action.UNKNOWN)"
          >
            <nb-icon
              [ngClass]="['float-right', 'mr-2']"
              icon="checkmark-outline"
            ></nb-icon>
            Unknown
          </nb-option>
          <nb-option
            tock-click-capture
            (click)="handleBatchAction(Action.DELETE)"
          >
            <nb-icon
              [ngClass]="['float-right', 'mr-2']"
              icon="trash-2-outline"
            ></nb-icon>
            Delete
          </nb-option>
        </nb-select>
      </div>
    </nb-form-field>
  </div>

  <div class="text-right">
    <tock-pagination
      [pagination]="pagination"
      (onPaginationChange)="paginationChange($event)"
    ></tock-pagination>
  </div>
</div>

<nb-card
  *ngFor="let sentence of sentences"
  class="mb-2"
>
  <nb-card-body class="grid-columns">
    <nb-checkbox
      [checked]="isSentenceSelected(sentence)"
      (checkedChange)="toggle(sentence)"
    ></nb-checkbox>

    <div
      (click)="toggle(sentence)"
      class="pointer"
    >
      <small class="d-block text-muted">
        {{ sentence.creationDate | amDateFormat: 'MM/DD HH:mm' }}
      </small>
      <span>
        {{ sentence.text }}
      </span>
    </div>

    <div class="select-intent">
      <input
        nbInput
        fullWidth
        type="text"
        placeholder="{{ selectIntent(sentence, 'placeholder') }}"
        (blur)="onBlur($event)"
        (keyup.escape)="onBlur($event)"
        (keyup)="filterIntentsList($event)"
        autocomplete="off"
        [nbAutocomplete]="intentsAutocomplete"
      />
      <nb-autocomplete
        size="tiny"
        #intentsAutocomplete
        (selectedChange)="addIntentToSentence($event, sentence)"
      >
        <nb-option-group
          *ngFor="let group of filteredIntentGroups | async"
          [title]="group.category"
        >
          <nb-option
            *ngFor="let intent of group.intents"
            [value]="intent._id"
          >
            {{ intent.label || intent.name }}
          </nb-option>
        </nb-option-group>
      </nb-autocomplete>

      <span nbTooltip="Detection probability"> {{ selectIntent(sentence, 'probability') }}% </span>
      <button
        *ngIf="state.hasRole(UserRole.botUser)"
        nbButton
        nbTooltip="Create new FAQ"
        ghost
        shape="round"
        (click)="redirectToFaqManagement(sentence)"
      >
        <nb-icon icon="plus-circle-outline"></nb-icon>
      </button>
    </div>

    <div>
      <button
        nbButton
        nbTooltip="Validate"
        class="tock--success"
        ghost
        shape="round"
        (click)="handleAction(Action.VALIDATE, sentence)"
      >
        <nb-icon icon="checkmark-circle-2"></nb-icon>
      </button>

      <button
        nbButton
        nbTooltip="Unknown"
        class="tock--danger"
        ghost
        shape="round"
        (click)="handleAction(Action.UNKNOWN, sentence)"
      >
        <nb-icon icon="close-circle-outline"></nb-icon>
      </button>

      <button
        nbButton
        nbTooltip="Delete"
        ghost
        shape="round"
        (click)="handleAction(Action.DELETE, sentence)"
      >
        <nb-icon icon="trash-2-outline"></nb-icon>
      </button>
    </div>
  </nb-card-body>
</nb-card>
